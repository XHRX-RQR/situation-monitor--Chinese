# 🌐 DeepLX 翻译功能使用指南

## 功能概述

态势监控系统已集成 **DeepLX 沉浸式翻译 API**,为您提供实时、准确的新闻内容翻译服务,帮助您更好地理解全球新闻动态。

## ✨ 主要特性

### 1. **一键翻译**
- 每条新闻旁边都有翻译按钮 🇨🇳
- 点击即可翻译标题和描述
- 支持在原文和译文之间切换

### 2. **智能缓存**
- 翻译结果自动缓存,无需重复翻译
- 大幅提升响应速度
- 节省 API 调用次数

### 3. **批量翻译**
- 支持同时翻译多条新闻
- 智能并发控制,避免 API 限流
- 自动错误处理和重试

### 4. **灵活配置**
- 启用/禁用翻译功能
- 选择是否自动翻译新加载的新闻
- 同时显示原文和译文(双语对照)

## 🎯 使用方法

### 方法一:手动翻译单条新闻

1. 在任何新闻条目上,找到来源信息旁的翻译按钮
2. 点击 🇨🇳 图标开始翻译
3. 翻译中会显示 🔄 旋转图标
4. 翻译完成后显示 🌐 图标,内容自动切换为中文
5. 再次点击可切换回原文

### 方法二:在设置中配置自动翻译

1. 点击右上角的 ⚙️ 设置按钮
2. 找到"翻译设置"部分
3. 勾选以下选项:
   - ✅ **启用翻译功能** - 显示翻译按钮
   - ✅ **自动翻译新闻** - 新加载的新闻自动翻译
   - ✅ **同时显示原文** - 译文下方显示原文

### 清除翻译缓存

如果需要清除缓存的翻译结果:
1. 打开设置 → 翻译设置
2. 查看当前缓存条目数量
3. 点击"清除缓存"按钮

## 🔧 技术实现

### API 配置

```typescript
// DeepLX API 端点
URL: https://api.deeplx.org/Z-JfCHlUsFJvglsRpLYwGS9Syd7ycbUyjkTcdDaQLmU/translate

// API 密钥
KEY: Z-JfCHlUsFJvglsRpLYwGS9Syd7ycbUyjkTcdDaQLmU
```

### 核心文件

```
src/lib/
├── services/
│   └── translation.ts          # 翻译服务核心逻辑
├── stores/
│   └── translation.ts          # 翻译状态管理
├── types/
│   └── index.ts                # NewsItem 类型扩展
└── components/
    ├── common/
    │   └── NewsItem.svelte     # 新闻组件(含翻译按钮)
    └── modals/
        └── SettingsModal.svelte # 设置界面
```

### 数据结构

```typescript
interface NewsItem {
  // ... 原有字段
  translatedTitle?: string;        // 翻译后的标题
  translatedDescription?: string;  // 翻译后的描述
  isTranslating?: boolean;         // 是否正在翻译
}
```

### API 请求格式

```json
{
  "text": "Breaking news from around the world",
  "target_lang": "zh",
  "source_lang": "auto"
}
```

### API 响应格式

```json
{
  "code": 200,
  "data": "来自世界各地的突发新闻",
  "alternatives": ["..."],
  "source_lang": "en",
  "target_lang": "zh"
}
```

## ⚡ 性能优化

### 1. **翻译缓存**
- 使用 Map 存储翻译结果
- 缓存键格式: `${targetLang}:${originalText}`
- 缓存命中时无需调用 API

### 2. **并发控制**
- 批量翻译时限制并发数(默认3)
- 请求间隔100ms,避免触发限流
- 智能队列管理

### 3. **错误处理**
- API 失败时返回原文
- 静默处理错误,不影响用户体验
- 控制台输出详细日志(开发模式)

## 🎨 UI/UX 设计

### 翻译按钮状态

| 状态 | 图标 | 颜色 | 说明 |
|------|------|------|------|
| 未翻译 | 🇨🇳 | 蓝色 | 点击开始翻译 |
| 翻译中 | 🔄 | 蓝色(旋转) | 正在调用 API |
| 已翻译 | 🌐 | 绿色 | 显示译文,点击切换 |

### 视觉反馈

- **加载动画**: 翻译中按钮旋转
- **颜色变化**: 已翻译按钮变为绿色
- **原文显示**: 可选择在译文下方显示原文
- **平滑过渡**: 所有状态切换都有过渡动画

## 📊 使用统计

在设置界面中可以查看:
- **缓存条目数**: 当前缓存的翻译数量
- **翻译状态**: 启用/禁用
- **自动翻译**: 开/关

## 🚀 未来规划

- [ ] 支持更多目标语言
- [ ] 翻译质量评分
- [ ] 批量导出翻译结果
- [ ] 自定义翻译引擎
- [ ] 离线翻译缓存持久化
- [ ] 翻译历史记录

## 🐛 故障排查

### 翻译按钮不显示
- 检查设置中是否启用了"启用翻译功能"
- 刷新页面重新加载配置

### 翻译失败
- 检查网络连接
- 查看浏览器控制台错误信息
- 确认 API 密钥正确
- 尝试清除缓存后重试

### 翻译速度慢
- 可能是网络延迟或 API 限流
- 批量翻译时会有延迟保护机制
- 已翻译的内容会从缓存读取,速度很快

## 💡 最佳实践

1. **首次使用**: 先手动翻译几条新闻测试效果
2. **日常使用**: 开启自动翻译,新闻加载后自动显示中文
3. **深度阅读**: 启用"同时显示原文",对照学习
4. **性能优化**: 定期清除缓存释放内存
5. **移动端**: 翻译按钮针对小屏幕优化,触控友好

## 📝 更新日志

### v1.0.0 (当前版本)
- ✅ 集成 DeepLX API
- ✅ 实现单条翻译功能
- ✅ 添加翻译缓存机制
- ✅ 批量翻译支持
- ✅ 设置界面集成
- ✅ UI/UX 优化

---

**享受沉浸式翻译体验! 🎉**

如有问题或建议,请在设置中反馈。
